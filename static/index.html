<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>ROSS: Raven Optimized Schedule System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg: #0b0f14;
      --panel: #121922;
      --panel-2: #0f151d;
      --text: #e9eef5;
      --muted: #96a3b6;
      --chip-bg: #1a2431;
      --chip-br: #223043;
      --line: #243244;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 14px;
      --radius-sm: 10px;
      --gap: 28px;
      --content-max: 1400px;
    }

    *{ box-sizing:border-box; }
    html, body { height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      color: var(--text);
      background: radial-gradient(1200px 600px at 50% -200px, #152232 0%, #0b0f14 60%);
      background-attachment: fixed;
    }

    /* Hero */
    .hero{
      text-align:center;
      padding: 36px 16px 10px;
    }
    .hero h1{
      margin: 0;
      font-size: clamp(64px, 12vw, 160px);
      letter-spacing: 0.06em;
      line-height: .85;
      font-weight: 900;
      background: linear-gradient(180deg, #fff 0%, #b9c6d9 80%);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 6px 30px rgba(255,255,255,0.07);
    }
    .hero h2{
      margin: 12px 0 6px;
      font-size: clamp(18px, 2.6vw, 38px);
      font-weight: 600;
      color: var(--muted);
      letter-spacing:.02em;
    }
    .hero-actions { margin-top: 10px; }
    .ghost-btn{
      background: transparent;
      border: 1.5px solid #7fa0c6;
      color: #e9eef5;
      padding: 8px 14px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: background .15s ease, color .15s ease, border-color .15s;
    }
    .ghost-btn:hover{ background:#152232; border-color:#b9c6d9; }

    /* Content */
    .content{
      max-width: var(--content-max);
      margin: 0 auto;
      padding: 10px clamp(10px, 4vw, 28px) 40px;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--gap);
      align-items:start;
    }
    @media (max-width: 1000px){
      .grid{ grid-template-columns: 1fr; }
    }

    /* Cards */
    .card{
      background: linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%);
      border: 1px solid #1e2a39;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
    }
    .card h3{
      margin: 4px 6px 12px;
      font-size: clamp(18px, 2vw, 24px);
      font-weight: 700;
      letter-spacing:.01em;
    }

    /* Inputs */
    .field-wrap{ position:relative; }
    .input{
      width:100%;
      padding: 14px 16px;
      font-size: 16px;
      color: var(--text);
      background: #0e141c;
      border: 1px solid #223043;
      border-radius: var(--radius-sm);
      outline: none;
      transition: border-color .15s ease, box-shadow .15s ease;
    }
    .input::placeholder{ color:#6f7f96; }
    .input:focus{
      border-color: #75f7c1;
      box-shadow: 0 0 0 4px rgba(0, 210, 127, .15);
    }

    /* Dropdown (autocomplete) */
    .dropdown{
      position:absolute;
      top: calc(100% + 8px);
      left:0; right:0;
      background:#0e141c;
      border:1px solid #223043;
      border-radius: 12px;
      box-shadow: var(--shadow);
      max-height: 260px;
      overflow-y:auto;
      display:none;
      z-index: 20;
    }
    .dropdown ul{ list-style:none; margin:0; padding:6px; }
    .dropdown li{
      padding: 10px 12px;
      border-radius: 10px;
      cursor:pointer;
      color: #d9e4f2;
    }
    .dropdown li:hover,
    .dropdown li.active{
      background:#142030;
      color:#fff;
    }

    /* Chips */
    .chips{
      margin: 14px 6px 0;
      padding: 0;
      list-style:none;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap: 10px;
      padding: 8px 12px;
      background: var(--chip-bg);
      border: 1px solid var(--chip-br);
      border-radius: 999px;
      font-size: 14px;
      color:#d5dfec;
    }
    .chip button{
      border:none; background:transparent; color:#aebad0;
      cursor:pointer; font-size:18px; line-height:1;
    }
    .chip button:hover{ color:#fff; }

    .hint{
      margin: 8px 6px 0;
      color:#7f90a8; font-size:12px;
    }

    .sep{ height:1px; background: linear-gradient(90deg, transparent, var(--line), transparent); margin: 16px 6px; border:0; }

    /* CTA */
    .cta-wrap{
      text-align:center;
      margin: 52px 0 16px;
    }
    .cta{
      display:inline-block;
      width: min(50%, 900px); /* centers: 25% to 75% */
      padding: 26px 0;
      font-size: clamp(22px, 3vw, 38px);
      font-weight: 800;
      border: 2px solid #fff;
      border-radius: 14px;
      background:#fff;
      color:#000;
      letter-spacing:.03em;
      cursor:pointer;
      transition: transform .08s ease, background .15s ease, color .15s ease, border-color .15s ease;
      user-select:none;
    }
    .cta:hover{
      background:#000; color:#fff; border-color:#000;
    }
    .cta:disabled{ opacity:.6; cursor: not-allowed; }

    /* Loading + result */
    .loading{
      display:none;
      text-align:center;
      margin: 24px 0 10px;
    }
    .spinner{
      margin: 0 auto 14px;
      width: 64px; height: 64px;
      border: 6px solid #2b394c;
      border-top: 6px solid #ffffff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      filter: drop-shadow(0 6px 16px rgba(0,0,0,.35));
    }
    .loading p{
      margin:0;
      font-size: clamp(16px, 2.2vw, 22px);
      font-weight:700;
      color:#dbe6f6;
      letter-spacing:.02em;
    }
    @keyframes spin{ to{ transform: rotate(360deg); } }

    .result{
      display:none;
      text-align:center;
      margin: 18px 0 60px;
      font-weight:700;
      color:#e3eefc;
    }

    /* Modal overlay + dialog */
    .modal-overlay{
      position: fixed; inset: 0;
      background: rgba(7,10,14,.65);
      display: none;                 /* hidden by default */
      align-items: center; justify-content: center;
      z-index: 1000;
      padding: 24px;
    }
    .modal{
      width: min(860px, 92vw);
      max-height: 84vh;
      background: linear-gradient(180deg, #141b25 0%, #0f151d 100%);
      border: 1px solid #1e2a39;
      border-radius: 16px;
      box-shadow: 0 14px 48px rgba(0,0,0,.5);
      position: relative;
      overflow: hidden;
      display: flex; flex-direction: column;
    }
    .modal h2{
      margin: 0; padding: 18px 22px;
      font-size: clamp(22px, 2.6vw, 28px);
      border-bottom: 1px solid #243244;
    }
    .modal-body{
      padding: 18px 22px 22px;
      overflow: auto;              /* scrollable content */
    }
    .modal-close{
      position: absolute; top: 10px; right: 12px;
      background: transparent; border: none; color: #aebad0;
      font-size: 28px; line-height: 1; cursor: pointer;
    }
    .modal-close:hover{ color: #fff; }

    .bio-list{ list-style: none; padding: 0; margin: 0 0 8px; }
    .bio-list li{
      padding: 10px 0; border-bottom: 1px solid #223043;
    }
    .bio-list strong{ color: #e3eefc; }
    .bio-list span{ color: #9fb0c7; }
    .muted{ color:#96a3b6; font-size: 14px; }

    /* Optional nicer scrollbars for modal */
    .modal-body::-webkit-scrollbar{ width: 10px; }
    .modal-body::-webkit-scrollbar-thumb{ background:#243244; border-radius: 10px; }

    /* === Schedule table styles (Excel-like columns) === */
    .schedule-grid{
      display: grid;
      grid-auto-flow: column;                  /* flow columns left → right */
      grid-auto-columns: minmax(260px, 1fr);   /* column width, responsive */
      gap: 12px;                               /* space between terms */
      overflow-x: auto;                        /* allow horizontal scroll */
      padding-bottom: 6px;
      scrollbar-width: thin;
    }
    .schedule-term{
      margin: 0; /* remove outer margins so columns line up tightly */
      background: linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%);
      border: 1px solid #1e2a39;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    .schedule-term h4{
      margin: 0; padding: 12px 14px; border-bottom: 1px solid var(--line);
    }
    .schedule-term table{ width:100%; border-collapse: collapse; }
    .schedule-term th, .schedule-term td{
      padding: 8px 10px; border-bottom: 1px solid #223043; text-align: left; font-size: 13px; color:#dbe6f6;
      white-space: nowrap;                      /* compact, spreadsheet feel */
    }
    .schedule-term th{ background:#0f151d; font-weight:700; color:#e9eef5; }
    .schedule-term tr:last-child td{ border-bottom:0; }
    .schedule-summary{
      padding: 8px 10px; border-top: 1px dashed var(--line); color:#9fb0c7; font-size:12px;
      white-space: nowrap;
    }
  </style>
</head>
<body>

  <!-- HERO -->
  <header class="hero">
    <h1>ROSS</h1>
    <h2>Raven Optimized Scheduling System</h2>
    <div class="hero-actions">
      <button id="openWho" class="ghost-btn">Who we are</button>
    </div>
  </header>

  <!-- CONTENT -->
  <main class="content">
    <section class="grid">
      <!-- LEFT: Autocomplete picker -->
      <div class="card" aria-labelledby="left-title">
        <h3 id="left-title">Search for your courses/majors</h3>
        <div class="field-wrap">
          <input
            class="input"
            id="searchInput"
            type="text"
            placeholder="Type to search…"
            aria-autocomplete="list"
            aria-expanded="false"
            aria-controls="dropdownList"
          />
          <div id="dropdown" class="dropdown" role="listbox">
            <ul id="dropdownList"></ul>
          </div>
          <p class="hint">Start typing to search for a major and select from the list. </p>
        </div>

        <hr class="sep" />

        <h3>Selected</h3>
        <ul id="selectedList" class="chips" aria-live="polite"></ul>
      </div>

      <!-- RIGHT: Free-entry taken courses -->
      <div class="card" aria-labelledby="right-title">
        <h3 id="right-title">Courses already taken</h3>
        <form id="takenForm" autocomplete="off">
          <input
            class="input"
            id="takenInput"
            type="text"
            placeholder="e.g., THEO-1100 (press Enter to add)"
            autocomplete="off"
          />
        </form>
        <p class="hint">Type in classes taken as course code (THEO-1100). Press <strong>Enter</strong> to add; click × to remove.</p>

        <hr class="sep" />

        <h3>Taken list</h3>
        <ul id="takenList" class="chips" aria-live="polite"></ul>
      </div>
    </section>

    <!-- CTA BUTTON -->
    <div class="cta-wrap">
      <button id="makeScheduleBtn" class="cta">MAKE MY SCHEDULE!</button>
    </div>

    <!-- LOADING STATE -->
    <div id="loading" class="loading">
      <div class="spinner"></div>
      <p>Your super schedule is currently being created!</p>
    </div>

    <!-- SIMPLE RESULT MESSAGE -->
    <div id="result" class="result"></div>

    <!-- Schedule output (now horizontal, Excel-like) -->
    <div id="scheduleWrap" style="display:none; margin: 10px 0 70px;">
      <div id="schedule" class="schedule-grid"></div>
    </div>
  </main>

  <!-- WHO WE ARE MODAL -->
  <div id="whoOverlay" class="modal-overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="whoTitle">
      <button id="closeWho" class="modal-close" aria-label="Close dialog">×</button>
      <h2 id="whoTitle">Who we are</h2>

      <div class="modal-body">
        <p>Explanation of ROSS here.</p>

        <h3>Our mission</h3>
        <p>Maybe explain the mission here</p>

        <h3>Team</h3>
        <ul class="bio-list">
          <!--Can be copied to add more people-->
          <li>
            <strong>NAME HERE</strong> — JOB HERE<br>
            <span>EXPLANATION</span>
          </li>
        </ul>

        <h3>How it works</h3>
        <ol>
          <li>Select your intended majors and enter courses you have credit for.</li>
          <li>ROSS does cool stuffs with that</li>
          <li>BOOM ya get ur schedule back!</li>
        </ol>

        <p class="muted">Questions or ideas part here?</p>
      </div>
    </div>
  </div>

  <script>
    /* =========================
       LEFT: Autocomplete select
       ========================= */
    const COURSES = [
       "BA Accounting ","BA Architecture ","BA Art ","BA Art Education ","BS Astronomy ","BA Athletic Health Care ","BA Biochemistry ","BS Biochemistry ","BA Biology ","BA Biology ","BS Biology ","BS Chemical Engineering ","BA Chemistry ","BA Chemistry ","BS Chemistry ","BS Civil Engineering ","BA Classics ","BA Computer Science ","BS Computer Science ","BA Criminology ","BA Economics ","BS Electrical Engineering ","BA Elementary Education ","BS Engineering Physics ","BA English ","BA English ","BA English ","BA and Theatre Arts ","BA Finance ","BA Foreign Languages ","BA French ","BA French and Secondary Education ","BA Graphic Design ","BA History ","BA International Business ","BA International Studies ","BA Journalism and Mass Communications ","BA Management ","BA Marketing ","BA Mathematics ","BA Mathematics ","BS Mechanical Engineering ","BA Music ","BME Music Education ","BSN Nursing ","BA Philosophy ","BA Philosophy ","BA Physics ","BA Physics ","BS Physics ","BA Politics and Government ","BA Psychology ","BA Secondary Education ","BA Social Science ","BA Sociology ","BA Spanish ","BA Spanish and Secondary Education ","BA Special Education ","BA Strength and Conditioning ","BA Theatre Arts ","BA Theatre Arts Management ","BA Theology ","BA Art ","BA Evangelization & Catechesis ","BA Evangelization & Catechesis ","BA Exercise Science ","BA Exercise Science ","BA Exercise Science ","BA Exercise Science ","BA Finance ","BA Music ","BA Music ","BA Politics and Government ","BA Theology "
    ];
    const input        = document.getElementById('searchInput');
    const dropdown     = document.getElementById('dropdown');
    const dropdownList = document.getElementById('dropdownList');
    const selectedList = document.getElementById('selectedList');
    const selectedSet  = new Set();

    function renderDropdown(items) {
      dropdownList.innerHTML = '';
      if (!items.length) {
        dropdown.style.display = 'none';
        input.setAttribute('aria-expanded', 'false');
        return;
      }
      items.forEach((text, i) => {
        const li = document.createElement('li');
        li.textContent = text;
        li.role = 'option';
        if (i === 0) li.classList.add('active');
        li.addEventListener('click', () => selectCourse(text));
        dropdownList.appendChild(li);
      });
      dropdown.style.display = 'block';
      input.setAttribute('aria-expanded','true');
    }

    function filterCourses(q) {
      q = q.trim().toLowerCase();
      if (!q) {
        dropdown.style.display = 'none';
        input.setAttribute('aria-expanded','false');
        return;
      }
      const matches = COURSES.filter(c => c.toLowerCase().includes(q) && !selectedSet.has(c));
      renderDropdown(matches);
    }

    function addChip(listEl, setRef, text) {
      const li = document.createElement('li');
      li.className = 'chip';
      li.textContent = text;

      const btn = document.createElement('button');
      btn.type = 'button';
      btn.setAttribute('aria-label', 'Remove');
      btn.textContent = '×';
      btn.addEventListener('click', () => {
        setRef.delete(text);
        listEl.removeChild(li);
        if (listEl === selectedList) filterCourses(input.value);
        saveTaken();
      });

      li.appendChild(btn);
      listEl.appendChild(li);
    }

    function selectCourse(text) {
      if (selectedSet.has(text)) return;
      selectedSet.add(text);
      addChip(selectedList, selectedSet, text);
      input.value = '';
      dropdown.style.display = 'none';
      input.setAttribute('aria-expanded','false');
      input.focus();
    }

    function moveActive(delta) {
      const items = [...dropdownList.querySelectorAll('li')];
      if (!items.length) return;
      let idx = items.findIndex(li => li.classList.contains('active'));
      if (idx === -1) idx = 0;
      items[idx].classList.remove('active');
      idx = (idx + delta + items.length) % items.length;
      items[idx].classList.add('active');
      items[idx].scrollIntoView({ block: 'nearest' });
    }

    input.addEventListener('input', e => filterCourses(e.target.value));
    input.addEventListener('keydown', e => {
      if (dropdown.style.display !== 'block') return;
      if (e.key === 'ArrowDown') { e.preventDefault(); moveActive(1); }
      else if (e.key === 'ArrowUp') { e.preventDefault(); moveActive(-1); }
      else if (e.key === 'Enter') {
        e.preventDefault();
        const active = dropdownList.querySelector('li.active');
        if (active) selectCourse(active.textContent);
      } else if (e.key === 'Escape') {
        dropdown.style.display = 'none';
        input.setAttribute('aria-expanded','false');
      }
    });
    document.addEventListener('click', e => {
      if (!e.target.closest('.field-wrap')) {
        dropdown.style.display = 'none';
        input.setAttribute('aria-expanded','false');
      }
    });

    /* =======================================
       RIGHT: Free-entry list with persistence
       ======================================= */
    const takenForm  = document.getElementById('takenForm');
    const takenInput = document.getElementById('takenInput');
    const takenList  = document.getElementById('takenList');
    const STORAGE_KEY = 'ross_taken_courses';
    const takenItems = new Set(JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'));

    function saveTaken(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify([...takenItems]));
    }

    function addTakenChip(text) {
      const li = document.createElement('li');
      li.className = 'chip';
      li.textContent = text;

      const btn = document.createElement('button');
      btn.type = 'button';
      btn.setAttribute('aria-label', 'Remove');
      btn.textContent = '×';
      btn.addEventListener('click', () => {
        takenItems.delete(text);
        takenList.removeChild(li);
        saveTaken();
      });

      li.appendChild(btn);
      takenList.appendChild(li);
    }

    // Hydrate saved items
    takenItems.forEach(addTakenChip);

    // Prevent navigation
    takenForm.addEventListener('submit', e => e.preventDefault());

    // Enter to add
    takenInput.addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        e.preventDefault();
        let val = takenInput.value.trim();
        if (!val) return;
        val = val.toUpperCase(); // normalize
        if (takenItems.has(val)) { takenInput.value=''; return; }
        takenItems.add(val);
        addTakenChip(val);
        saveTaken();
        takenInput.value = '';
      }
    });

    /* ============================
       CTA: Show loading + POST JSON
       ============================ */
    const btn      = document.getElementById('makeScheduleBtn');
    const loading  = document.getElementById('loading');
    const resultEl = document.getElementById('result');

    btn.addEventListener('click', async () => {
      // UI: show loader, lock button
      loading.style.display = 'block';
      resultEl.style.display = 'none';
      resultEl.textContent = '';
      btn.disabled = true;

      // Build JSON payload for backend
      const payload = {
        majors: Array.from(selectedSet),      // left column selections
        courses_taken: Array.from(takenItems) // right column free entries
      };

      try {
        const res = await fetch('/api/schedule', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        console.log('Response →', data);

        // Show server message (and optionally more details)
        loading.style.display = 'none';
        resultEl.style.display = 'block';
        resultEl.textContent = data?.message || data?.status || 'Schedule request received!';

        // Locate semesters in common shapes or fall back to a small mock so you see tables
        let semesters =
          data?.semesters ||
          data?.plan?.semesters ||
          data?.schedule?.semesters ||
          (data && typeof data === 'object' &&
           Object.keys(data).some(k => /^semester[- _]?\d+$/i.test(k)) ? data : null);

        if (!semesters) {
          console.warn('No semesters in response; using mock so the table renders.');
          semesters = {
            "semester-1": [
              ["MATH","101",3,"Calculus I"],["CHEM","110",4,"General Chemistry I"],
              ["ENGL","120",3,"Composition"],["THEO","1100",3,"Intro to Theology"],["HIST","150",3,"World History I"]
            ],
            "semester-2": [
              ["MATH","102",3,"Calculus II"],["CHEM","120",4,"General Chemistry II"],
              ["PHYS","130",4,"Physics I"],["PHIL","101",3,"Intro to Philosophy"],["ENGL","200",3,"Literature Survey"]
            ]
          };
        }

        renderSchedule(semesters);
      } catch (err) {
        loading.style.display = 'none';
        resultEl.style.display = 'block';
        resultEl.textContent = 'Something went wrong sending your data. Try again.';
        console.error(err);
        document.getElementById('scheduleWrap').style.display = 'none';
      } finally {
        btn.disabled = false; // make clickable again; remove if you want it to stay disabled
      }
    });

    /* ============================
       WHO WE ARE MODAL
       ============================ */
    const openWho   = document.getElementById('openWho');
    const overlay   = document.getElementById('whoOverlay');
    const closeWho  = document.getElementById('closeWho');
    let lastFocused = null;

    function getFocusable(container){
      return [...container.querySelectorAll(
        'a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])'
      )];
    }

    function openModal(){
      lastFocused = document.activeElement;
      overlay.style.display = 'flex';
      overlay.setAttribute('aria-hidden','false');
      // lock background scroll
      document.body.dataset.prevOverflow = document.body.style.overflow || '';
      document.body.style.overflow = 'hidden';
      // focus first focusable in modal
      const focusables = getFocusable(overlay);
      if (focusables.length) focusables[0].focus();
      overlay.addEventListener('keydown', trapTab);
    }

    function closeModal(){
      overlay.style.display = 'none';
      overlay.setAttribute('aria-hidden','true');
      document.body.style.overflow = document.body.dataset.prevOverflow || '';
      if (lastFocused) lastFocused.focus();
      overlay.removeEventListener('keydown', trapTab);
    }

    function trapTab(e){
      if (e.key === 'Escape') { e.preventDefault(); closeModal(); return; }
      if (e.key !== 'Tab') return;
      const f = getFocusable(overlay);
      if (!f.length) return;
      const first = f[0], last = f[f.length - 1];
      if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); }
      else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
    }

    if (openWho) openWho.addEventListener('click', openModal);
    if (closeWho) closeWho.addEventListener('click', closeModal);
    overlay.addEventListener('click', (e) => { if (e.target === overlay) closeModal(); });

    /* ============================
       SCHEDULE RENDERER (no Notes col)
       ============================ */
function renderSchedule(semesters) {
  const wrap = document.getElementById('scheduleWrap');
  const container = document.getElementById('schedule');
  container.innerHTML = '';

  if (!semesters || typeof semesters !== 'object') {
    wrap.style.display = 'none';
    return;
  }

  const entries = Object.entries(semesters)
    .filter(([_, v]) => Array.isArray(v))
    .map(([key, rows]) => {
      const num = (String(key).match(/\d+/) || [9999])[0];
      return { key, num: parseInt(num, 10), rows };
    })
    .sort((a, b) => a.num - b.num);

  if (!entries.length) {
    wrap.style.display = 'none';
    return;
  }

  for (const { key, rows } of entries) {
    const term = document.createElement('div');
    term.className = 'schedule-term';

    const h = document.createElement('h4');
    h.textContent = prettifyTermName(key);
    term.appendChild(h);

    const table = document.createElement('table');
    const thead = document.createElement('thead');
    // Two columns only
    thead.innerHTML = `<tr>
      <th>Course</th>
      <th>Credits</th>
    </tr>`;
    table.appendChild(thead);

    const tbody = document.createElement('tbody');
    let termCredits = 0;

    rows.forEach((row) => {
      let subject = '', code = '', credits = '';

      if (Array.isArray(row)) {
        if (row.length >= 3 && typeof row[0] === 'string' && typeof row[1] === 'string') {
          subject = row[0];
          code = row[1];
          credits = row[2];
        } else {
          const first = String(row[0] ?? '');
          const parts = first.split(/[\s-]+/);
          subject = parts[0] || '';
          code = parts.slice(1).join(' ') || '';
          credits = row[1] ?? '';
        }
      } else if (row && typeof row === 'object') {
        subject = row.subject || row.dept || '';
        code    = row.code || row.number || '';
        credits = row.credits ?? row.credit_hours ?? '';
      }

      const credNum = (credits !== '' && credits != null && !Number.isNaN(+credits)) ? +credits : '';
      if (credNum !== '' && Number.isFinite(credNum)) termCredits += credNum;

      const courseCode = [subject, code].filter(Boolean).join('-');

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${escapeHtml(courseCode)}</td>
        <td>${credNum !== '' ? credNum : ''}</td>
      `;
      tbody.appendChild(tr);
    });

    table.appendChild(tbody);
    term.appendChild(table);

    const summary = document.createElement('div');
    summary.className = 'schedule-summary';
    summary.textContent = `Semester Credits: ${termCredits}`;
    term.appendChild(summary);

    container.appendChild(term);
  }

  wrap.style.display = 'block';
}

function prettifyTermName(key) {
  return String(key)
    .replace(/[_-]+/g, ' ')
    .replace(/\b\w/g, c => c.toUpperCase());
}

function escapeHtml(s) {
  return String(s ?? '')
    .replaceAll('&','&amp;')
    .replaceAll('<','&lt;')
    .replaceAll('>','&gt;')
    .replaceAll('"','&quot;')
    .replaceAll("'","&#39;");
}


  </script>
</body>
</html>
